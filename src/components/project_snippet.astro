---
import { number } from "astro:schema";
import leftArrow from "../assets/left arrow.png";
import rightArrow from "../assets/right arrow.png";
import github from "../assets/github2.png";

interface Props {
    title: string;
    techs: string[];
    description: string;
    images: string[];
    image_width: string;
    link: string;
    id: string;
}

const { title, techs, description, images, image_width, link, id } =
    Astro.props;
const uniqueId = id;
---

<div class="flex flex-col lg:flex-row w-full mt-20">
    <div class="flex flex-col lg:max-w-1/2 pl-5 lg:pl-10 pr-10">
        <p class="text-2xl font-bold md:text-3xl lg:text-4xl text-center lg:text-justify">
            {title}
        </p>

        <div
            class=" my-5 grid grid-cols-2 lg:grid-cols-4 gap-2 lg:gap-0 w-full justify-items-center "
        >
            {
                techs.map((tech) => (
                    <a class="flex text-sm lg:text-base w-full md:w-3/4 text-white bg-gray-800 mt-2 py-2 rounded-sm  justify-center">
                        {tech}
                    </a>
                ))
            }
        </div>

        <p class="text-2xl">About it:</p>
        <p class="text-xl lg:text-2xl text-justify">
            {description}
        </p>

        <div class="flex flex-row items-center mt-4 gap-5">
            <p class="text-xl">Code:</p>
            <a href=`${link}` class="w-8 h-8 lg:w-12 lg:h-12">
                <img src={github.src} class="rounded-md" />
            </a>
        </div>
    </div>

    <div class=`lg:mt-10 md:mt-10 m-auto`>
        <div
            class="overflow-hidden w-full relative lg:border-4 lg:border-gray-800"
        >
            <div
                id=`carousel-track-${uniqueId}`
                class=`flex ${image_width} transition-transform duration-500`
            >
                {
                    images.map((image, index) => (
                        <img
                            src={image}
                            class="w-full aspect-[5/4] md:aspect-auto lg:aspect-auto flex-shrink-0 object-contain"
                        />
                    ))
                }
            </div>

            <button
                id=`prev-button-${uniqueId}`
                class="absolute top-1/2 left-4 -translate-y-1/2 bg-neutral-300 bg-opacity-50 text-white p-3 rounded-full transition-all"
                aria-label="Anterior"
            >
                <img src={leftArrow.src} class="w-5 h-5" />
            </button>

            <button
                id=`next-button-${uniqueId}`
                class="absolute top-1/2 right-4 -translate-y-1/2 bg-neutral-300 bg-opacity-50 text-white p-3 rounded-full transition-all"
                aria-label="Siguiente"
            >
                <img src={rightArrow.src} class="w-5 h-5" />
            </button>
        </div>
    </div>
</div>

<script define:vars={{ uniqueId, images }}>
    const track = document.getElementById(`carousel-track-${uniqueId}`);
    const slides = Array.from(track.children);
    const nextButton = document.getElementById(`next-button-${uniqueId}`);
    const prevButton = document.getElementById(`prev-button-${uniqueId}`);
    let currentIndex = 0;

    const updateCarousel = () => {
        if (track) {
            const SlideWidth = slides[0].clientWidth;
            console.log(SlideWidth);
            track.style.transform = `translateX(-${currentIndex * 100}%)`;
        }
    };

    nextButton?.addEventListener("click", () => {
        currentIndex = (currentIndex + 1) % slides.length;
        console.log(currentIndex);
        updateCarousel();
    });

    prevButton?.addEventListener("click", () => {
        currentIndex = (currentIndex - 1 + slides.length) % slides.length;
        console.log(currentIndex);
        updateCarousel();
    });

    window.addEventListener("resize", updateCarousel);
    document.addEventListener("DOMContentLoaded", updateCarousel);

    updateCarousel();
</script>
