---
import leftArrow from '../assets/left arrow.png';
import rightArrow from '../assets/right arrow.png';

interface Props {
    title: string;
    techs: string[];
    description: string;
    images: string[];
    id: string
}

const { title, techs, description, images, id } = Astro.props;
const uniqueId = id;
---

<div class="flex flex-row w-full">
    <div class="flex flex-col w-1/2 h-full pl-20 justify-center">
        <p class="text-4xl">
            {title}
        </p>

        <div class="grid grid-cols-4 gap-5 my-5 w-full pr-20">
            {
                techs.map((tech) => (
                    <a class="flex text-2xl text-white bg-gray-800 px-2 py-1 mx-4 rounded-sm items-center justify-center">
                        {tech}
                    </a>
                ))
            }
        </div>

        <p class="text-2xl">About it:</p>
        <p class="text-2xl">
            {description}
        </p>
    </div>

    <div class="m-auto relative flex flex-row items-center">
        <div class="overflow-hidden transition-transform ease-in-out">
            <div id=`carousel-track-${uniqueId}` class="flex w-90 transition-transform duration-500 ease-in-out">
                {
                    images.map((image, index) => (
                        <img
                            src={image}
                            class="w-full flex-shrink-0 object-cover"
                        />
                    ))
                }
            </div>

            <button
                id=`prev-button-${uniqueId}`
                class="absolute top-1/2 left-4 -translate-y-1/2 bg-white bg-opacity-50 text-white p-3 rounded-full hover:bg-opacity-75 transition-all focus:outline-none"
                aria-label="Anterior">
                <img src={leftArrow.src} class="w-5 h-5"/>
            </button>

            <button
                id=`next-button-${uniqueId}`
                class="absolute top-1/2 right-4 -translate-y-1/2 bg-white bg-opacity-50 text-white p-3 rounded-full hover:bg-opacity-75 transition-all focus:outline-none"
                aria-label="Siguiente">
                <img src={rightArrow.src} class="w-5 h-5"/>
            </button>
        </div>
    </div>
</div>

<script define:vars={{uniqueId, images}}>
    const track = document.getElementById(`carousel-track-${uniqueId}`);
    const slides = Array.from(track.children);
    const nextButton = document.getElementById(`next-button-${uniqueId}`);
    const prevButton = document.getElementById(`prev-button-${uniqueId}`);
    let currentIndex = 0;

    const updateCarousel = () => {
        if (track) {
            const SlideWidth = slides[0].clientWidth;
            console.log(SlideWidth);
            track.style.transform = `translateX(-${currentIndex * SlideWidth}px)`;
        }
    };

    nextButton?.addEventListener("click", () => {
        currentIndex = (currentIndex + 1) % slides.length;
        console.log(currentIndex);
        updateCarousel();
    });

    prevButton?.addEventListener("click", () => {
        currentIndex = (currentIndex - 1 + slides.length) % slides.length;
        console.log(currentIndex);
        updateCarousel();
    });

    window.addEventListener("resize", updateCarousel);
    document.addEventListener("DOMContentLoaded", updateCarousel);

    updateCarousel();
</script>
